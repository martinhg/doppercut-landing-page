---
import { countries } from '../i18n/config';
import { ui } from '../i18n/content';

const country = (Astro.props.country ?? 'ar') as keyof typeof countries;
const currentCountry = countries[country] ?? countries.ar;
const lang = (currentCountry.lang ?? 'es_ar') as keyof typeof ui;
const t = ui[lang].nav;

const { pathname } = Astro.url;

const getCountryUrl = (targetCountryCode: string) => {
  const cleanPath = pathname.replace(new RegExp(`^/${country}`), '') || '';
  
  return `/${targetCountryCode}${cleanPath}`;
};

const link = (path: string) => {
  const cleanPath = path.startsWith('/') ? path : `/${path}`;
  return `/${country}${cleanPath}`;
};

---

<nav class='fixed w-full z-50 top-0 transition-all duration-300' id='navbar'>
  <div class='absolute inset-0 bg-white/80 backdrop-blur-md border-b border-slate-100' id='nav-bg'></div>
  <div class='max-w-7xl mx-auto px-6 h-20 flex items-center justify-between relative z-10'>
    <a href={link('/')} class='text-2xl font-bold text-navy flex items-center gap-2'>
      <img src="/logo.png" alt="Logo DopperCut" class="w-18 h-18 object-contain" />
      DopperCut
    </a>

    <div class='hidden md:flex items-center gap-8'>
      <a href={link('/')} class='text-sm font-medium text-slate hover:text-navy transition-colors'>{t.home}</a>
      <a href={link('/#como-funciona')} class='text-sm font-medium text-slate hover:text-navy transition-colors'>{t.how}</a>
      <a href={link('/precios')} class='text-sm font-medium text-slate hover:text-navy transition-colors'>{t.pricing}</a>
      <a href={link('/contacto')} class='text-sm font-medium text-slate hover:text-navy transition-colors'>{t.contact}</a>
    </div>

    <div class='flex items-center gap-4'>
      <div class='relative group'>
        <button class='flex items-center gap-2 text-sm font-bold text-navy hover:bg-slate-100 px-3 py-2 rounded-lg transition-colors border border-transparent hover:border-slate-200'>
          <span class='text-lg'>{currentCountry.flag}</span>
          <svg class='w-4 h-4 text-slate-400 group-hover:rotate-180 transition-transform duration-300' fill='none' viewBox='0 0 24 24' stroke='currentColor'>
            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'></path>
          </svg>
        </button>

        <div class='absolute right-0 top-full pt-2 w-48 hidden group-hover:block z-50'>
          <ul class='bg-white rounded-xl shadow-xl border border-slate-100 overflow-hidden'>
            <li class='px-4 py-2 text-xs font-semibold text-slate-400 uppercase tracking-wider border-b border-slate-50 bg-slate-50/50'>Selecciona tu país</li>
            {
              Object.values(countries).map((c) => (
                <li>
                  <a href={getCountryUrl(c.code)} class={`flex items-center gap-3 px-4 py-3 hover:bg-slate-50 text-sm transition-colors ${c.code === country ? 'bg-indigo-50/50 text-primary font-bold' : 'text-slate-700'}`}>
                    <span class='text-lg'>{c.flag}</span>
                    <span class='font-medium'>{c.name}</span>
                    {c.code === country && <span class='ml-auto text-primary text-xs'>●</span>}
                  </a>
                </li>
              ))
            }
          </ul>
        </div>
      </div>

      <a href='https://app.doppercut.com' target='_blank' class='hidden sm:block text-sm font-medium text-navy hover:text-primary transition-colors'>{t.login}</a>

      <a href={link('/contacto')} class='px-5 py-2.5 bg-navy text-white text-sm font-medium rounded-full hover:bg-slate-800 transition-colors shadow-lg shadow-navy/20'>
        {t.trial}
      </a>
    </div>
  </div>
</nav>

<script>
  // Efecto de sombra al hacer scroll
  const nav = document.getElementById('nav-bg');
  window.addEventListener('scroll', () => {
    if (!nav) return;

    if (window.scrollY > 20) {
      nav.classList.add('shadow-sm');
    } else {
      nav.classList.remove('shadow-sm');
    }
  });
</script>
